---
title: "A Comparison of Homerun Distance Between American League and National League Hitters"
author: "Caleb Pulsipher and Matt Drewes"
output: html_notebook
---

## Introduction

Explain the question you decided to research as well as the value of answering this question.

*Research Question:*

## Methods

Methods: Explain how the data were obtained, as well as providing a citation of their source. 
*The data were obtained from...*

Justify your choice of a likelihood (distribution) for the data. 
*We assume a normal distribution for the homerun distances of each population. This assumption is justified both by a histogram of each sample and by a normal probability plot of each sample.*

```{r, eval=TRUE, echo=FALSE}
par(mfrow=c(1,2))
hist(AL)
hist(NL)
```

```{r, eval=TRUE, echo=FALSE}
par(mfrow=c(1,2))
qqnorm(AL, main = "Normal Q-Q Plot of AL Data")
qqline(AL)
qqnorm(NL, main = "Normal Q-Q Plot of NL Data")
qqline(NL)
```



Explain what the relevant parameters are for the likelihood. Choose and justify your prior distributions. 
*The relevant parameters for the likelihood are the population mean and variance. We chooose the Normal(420, 15^2) distribution as the prior distribution for the mean homerun distance for both the American and National League, based on our best guess for the means and our understanding of the overall spread of homerun distances. We *

Plot the prior distributions. 

```{r, eval=TRUE, echo=FALSE}
prior_range <- seq(300,500,by=0.05)
prior_like <- dnorm(prior_range, mean = 420, sd = 15)

plot(prior_range, prior_like, type = 'l',
     main = "Prior Distribution",
     xlab = expression(mu),
     ylab = "Likelihood")
```

Explain how you will use the posterior distribution to answer your research question.

*We plan to use the posterior distributions to provide evidence for our research question both graphically and computationally. First, because we assumed an identical prior distribution, any difference in the visual representation of the posterior distributions may indicate a significant difference between the two leagues. With this information, we will analyze the differences between our simulated means and conclude whether or not we have sufficient evidence to conclude that there is a significant difference between the populations.*


## Results

Results: Report summary statistics for the data. Perform posterior inference on the parameters for each population and include two sets of properly formatted graphics: one that compares the parameters from the two populations to each other; another that compares the priors to the posteriors. Include and interpret credible intervals.  Then perform the posterior inference on the function of the parameters that directly answers your primary research question (for example, the difference in means, or the ratio of variances). Report and properly interpret an associated credible interval for this function of parameters. Include properly formatted and informative graphic(s) for this function of parameters. 

## Discussion

Summarize your results, identify shortcomings of the work, and explain what could be done in the future to either better answer your question or to address a natural follow-up question. 

## Appendix (R code)

```{r, include=FALSE}
# data <- read.csv("MLBdata.csv", header = TRUE, stringsAsFactors = FALSE)
# head(data)
# TAL <- c("BAL","BOS","CHW","CLE","DET","HOU","KC","LAA","MIN","NYY","OAK","SEA", "TEX","TB","TOR")
# AL <- data[data$Team %in% TAL,]
# NL <- data[!data$Team %in% TAL,]
```

```{r}
for (x in c("AL.RData","NL.RData","All.RData")){load(x)}
AL <- AL$True.Distance
NL <- NL$True.Distance
```


```{r, Results}
update.mu <- function(sigma2, ys, m, v){
  
  n <- length(ys)
  vstar <- 1/(n/sigma2+1/v)
  mstar <- vstar*(n*mean(ys)/sigma2+m/v)
  return( rnorm(1, mstar, sqrt(vstar)) )
  
}

update.var <- function(mu, ys, a, b){
  
  n <- length(ys)
  astar <- a + n/2
  bstar <- b + 0.5*sum( (ys-mu)^2 )
  return( 1/rgamma(1, astar, bstar) )
  
}
```

```{r, AL Gibbs}
obs_AL <- AL
m_AL <- 420
v_AL <- 225
a_AL <- 1 # We can look at changing these values
b_AL <- 1 # ^

set.seed(2017) 

N <- 100000
mus_AL <- rep(NA, N)
vars_AL <- rep(NA, N)

mus_AL[1] <- mean(obs_AL) 
vars_AL[1] <- var(obs_AL)

for (j in 2:N){
  mus_AL[j] <- update.mu(sigma2 = vars_AL[j-1], ys = obs_AL, m=m_AL, v=v_AL)
  vars_AL[j] <- update.var(mu = mus_AL[j], ys = obs_AL, a = a_AL, b = b_AL)
}
```

```{r, Plots AL}
par(mfrow = c(2,2))
plot(mus_AL[1:1000], type="l",
   main=expression(paste("Trace plot for ", mu)))

plot(vars_AL[1:1000], type="l",
  main=expression(paste(
   "Trace plot for ", sigma^2)))

acf(mus_AL, main = "") 

acf(vars_AL, main = "")
```

```{r, NL Gibbs}
obs_NL <- NL
m_NL <- 420
v_NL <- 225
a_NL <- 1 # We can look at changing these values
b_NL <- 1 # ^

set.seed(2017) 

N <- 100000
mus_NL <- rep(NA, N)
vars_NL <- rep(NA, N)

mus_NL[1] <- mean(obs_NL) 
vars_NL[1] <- var(obs_NL)

for (j in 2:N){
  mus_NL[j] <- update.mu(sigma2 = vars_NL[j-1], ys = obs_NL, m=m_NL, v=v_NL)
  vars_NL[j] <- update.var(mu = mus_NL[j], ys = obs_NL, a = a_NL, b = b_NL)
}
```

```{r}
plot(density(mus_AL))
lines(density(mus_NL))
```


```{r, Plots NL}
par(mfrow = c(2,2))
plot(mus_NL[1:1000], type="l",
   main=expression(paste("Trace plot for ", mu)))

plot(vars_NL[1:1000], type="l",
  main=expression(paste(
   "Trace plot for ", sigma^2)))

acf(mus_NL, main = "") 

acf(vars_NL, main = "")
```
