---
title: "A Comparison of Homerun Distance Between American League and National League Hitters"
author: "Caleb Pulsipher and Matt Drewes"
output: 
  pdf_document: 
    latex_engine: xelatex
---

```{r}
for (x in c("AL.RData","NL.RData","All.RData")){load(x)}
AL <- AL$True.Distance
NL <- NL$True.Distance
```


```{r, Results}
update.mu <- function(sigma2, ys, m, v){
  
  n <- length(ys)
  vstar <- 1/(n/sigma2+1/v)
  mstar <- vstar*(n*mean(ys)/sigma2+m/v)
  return( rnorm(1, mstar, sqrt(vstar)) )
  
}

update.var <- function(mu, ys, a, b){
  
  n <- length(ys)
  astar <- a + n/2
  bstar <- b + 0.5*sum( (ys-mu)^2 )
  return( 1/rgamma(1, astar, bstar) )
  
}
```

```{r, AL Gibbs}
obs_AL <- AL
m_AL <- 420
v_AL <- 225
a_AL <- 1
b_AL <- 1

set.seed(2017) 

N <- 100000
mus_AL <- rep(NA, N)
vars_AL <- rep(NA, N)

mus_AL[1] <- mean(obs_AL) 
vars_AL[1] <- var(obs_AL)

for (j in 2:N){
  mus_AL[j] <- update.mu(sigma2 = vars_AL[j-1], ys = obs_AL, m=m_AL, v=v_AL)
  vars_AL[j] <- update.var(mu = mus_AL[j], ys = obs_AL, a = a_AL, b = b_AL)
}
```

```{r, Plots AL}
par(mfrow = c(2,2))
plot(mus_AL[1:1000], type="l",
   main=expression(paste("Trace plot for ", mu)))

plot(vars_AL[1:1000], type="l",
  main=expression(paste(
   "Trace plot for ", sigma^2)))

acf(mus_AL, main = "") 

acf(vars_AL, main = "")
```

```{r, NL Gibbs}
obs_NL <- NL
m_NL <- 420
v_NL <- 225
a_NL <- 1 # We can look at changing these values
b_NL <- 1 # ^

set.seed(2017) 

N <- 100000
mus_NL <- rep(NA, N)
vars_NL <- rep(NA, N)

mus_NL[1] <- mean(obs_NL) 
vars_NL[1] <- var(obs_NL)

for (j in 2:N){
  mus_NL[j] <- update.mu(sigma2 = vars_NL[j-1], ys = obs_NL, m=m_NL, v=v_NL)
  vars_NL[j] <- update.var(mu = mus_NL[j], ys = obs_NL, a = a_NL, b = b_NL)
}
```

```{r, Plots NL}
par(mfrow = c(2,2))
plot(mus_NL[1:1000], type="l",
   main=expression(paste("Trace plot for ", mu)))

plot(vars_NL[1:1000], type="l",
  main=expression(paste(
   "Trace plot for ", sigma^2)))

acf(mus_NL, main = "") 

acf(vars_NL, main = "")
```


## Introduction

Explain the question you decided to research as well as the value of answering this question.

The question we decided to answer is if there is any difference between home run distance among the American league compared to the National League of the Major League Baseball. The value to answering this question is to see which league, if either, has a statical advantage when it comes to distance of home runs. This is important because each field has varying distances for a home run, which would give a competitive edge to the league that on average can hit farther home runs.

## Methods

Methods: Explain how the data were obtained, as well as providing a citation of their source. 
*The data were obtained from ESPN’s site hittrackeronline.com (URL: http://www.hittrackeronline.com/top_true_distance.php). This site is ran by ESPN Stats and Information Group. It shows a list of all of the home runs hit in the 2017 season, who hit the home run, what team they play for, and the true distance of how far the ball was hit in feet.*

Justify your choice of a likelihood (distribution) for the data. 
*We assume a normal distribution for the homerun distances of each population. This assumption is justified both by a histogram of each sample and by a normal probability plot of each sample.*

```{r, eval=TRUE, echo=FALSE}
par(mfrow=c(1,2))
hist(AL)
hist(NL)
```

```{r, eval=TRUE, echo=FALSE}
par(mfrow=c(1,2))
qqnorm(AL, main = "Normal Q-Q Plot of AL Data")
qqline(AL)
qqnorm(NL, main = "Normal Q-Q Plot of NL Data")
qqline(NL)
```



Explain what the relevant parameters are for the likelihood. Choose and justify your prior distributions. 
*The relevant parameters for the likelihood are the population mean and variance. It is reasonable to assume the data are conditionally iid and normally distributed. For the prior distribution of μ, we have chosen a Normal distribution with a mean of 420ft. and a variance of 15^2ft. For the prior distribution for σ2, we have chosen an inverse gamma with shape=1 and rate=1  for the prior distribution for the mean homerun distance for both the American and National League, based on our best guess for the means and our understanding of the overall spread of homerun distances.*

Plot the prior distributions. 

```{r, eval=TRUE, echo=FALSE}
prior_range <- seq(300,500,by=0.05)
prior_like <- dnorm(prior_range, mean = 420, sd = 15)
plot(prior_range, prior_like, type = 'l',
     main = "Prior Distribution of the Mean",
     xlab = expression(mu),
     ylab = "Likelihood")
```

```{r}
library(invgamma)
prior_range <- seq(0,10,by=0.05)
# prior_like <- 1/dgamma(prior_range, shape = 1, rate = 1)
prior_like <- dinvgamma(prior_range, shape = 1, rate = 1)
plot(prior_range, prior_like, type = 'l',
     main = "Prior Distribution of the Variance",
     xlab = expression(sigma^2),
     ylab = "Likelihood")
```

Explain how you will use the posterior distribution to answer your research question.

*We wish to do an analysis for the overall home run distance, not just the 2017 season. For that we will use Gibbs sampling to estimate the parameters and compare to find if there is a difference among the two leagues. We will use the data from the 2017 season and the prior we have set for the sampling. Our prior of ~ N(420,15^2) with the prior of sigma^2 being the inverse gamma distribution with shape = and rate = .We plan to use the posterior distributions to provide evidence for our research question both graphically and computationally. First, because we assumed an identical prior distribution, any difference in the visual representation of the posterior distributions may indicate a significant difference between the two leagues. With this information, we will analyze the differences between our simulated means and conclude whether or not we have sufficient evidence to conclude that there is a significant difference in the populations.*


## Results

Results: Report summary statistics for the data. 
*Mean of American League Mean Homerun Distance:*
```{r, eval=TRUE, echo=FALSE}
mean(mus_AL)
```

*Standard Deviation of American League Mean Homerun Distance:*
```{r, eval=TRUE, echo=FALSE}
sd(mus_AL)
```


*Mean of National League Mean Homerun Distance:*
```{r, eval=TRUE, echo=FALSE}
mean(mus_NL)
```

*Standard Deviation of National League Mean Homerun Distance:*
```{r, eval=TRUE, echo=FALSE}
sd(mus_NL)
```


*Mean of American League Mean Homerun Distance:*
```{r, eval=TRUE, echo=FALSE}
mean(vars_AL)
```

*Standard Deviation of American League Mean Homerun Distance:*
```{r, eval=TRUE, echo=FALSE}
sd(vars_AL)
```

*Mean of American League Mean Homerun Distance:*
```{r, eval=TRUE, echo=FALSE}
mean(vars_NL)
```

*Standard Deviation of American League Mean Homerun Distance:*
```{r, eval=TRUE, echo=FALSE}
sd(vars_NL)
```


Perform posterior inference on the parameters for each population and include two sets of properly formatted graphics: one that compares the parameters from the two populations to each other; another that compares the priors to the posteriors. Include and interpret credible intervals.  
```{r, eval=TRUE, echo=FALSE}
plot(density(mus_AL), main = "Estimated Density of Means", xlab = expression(mu))
lines(density(mus_NL), lty = 2)
legend("topright", c('AL','NL'), lty = c(1,2))
```

```{r, eval=TRUE, echo=FALSE}
plot(density(vars_AL), main = "Estimated Density of Variances", xlab = expression(sigma^2),
     xlim = c(500,800), ylim = c(0,0.025))
lines(density(vars_NL), lty = 2)
legend("topright", c('AL','NL'), lty = c(1,2))
```

```{r, eval=TRUE, echo=FALSE}
prior_range <- seq(350,450,by=0.05)
prior_like <- dnorm(prior_range, mean = 420, sd = 15)

plot(prior_range, prior_like, type = 'l',
     main = "Prior/Post Dist. of AL Mean",
     xlab = expression(mu),
     ylab = "Likelihood", ylim = c(0,0.8))
lines(density(mus_AL), lty = 2)
legend("topright", c('Prior','Posterior'), lty = c(1,2))
```

```{r, eval=TRUE, echo=FALSE}
prior_range <- seq(300,500,by=0.05)
prior_like <- dnorm(prior_range, mean = 420, sd = 15)

plot(prior_range, prior_like, type = 'l',
     main = "Prior/Post Dist. of NL Mean",
     xlab = expression(mu),
     ylab = "Likelihood", ylim = c(0,0.8))
lines(density(mus_NL), lty = 2)
legend("topright", c('Prior','Posterior'), lty = c(1,2))
```

```{r, eval=TRUE, echo=FALSE}
prior_range <- seq(500,800,by=0.05)
prior_like <- dinvgamma(prior_range, shape = 1, rate = 1)

plot(prior_range, prior_like, type = 'l',
     main = "Prior/Post Dist. of AL Variance",
     xlab = expression(sigma^2),
     ylab = "Likelihood", ylim = c(0,0.025))
lines(density(vars_AL), lty = 2)
legend("topright", c('Prior','Posterior'), lty = c(1,2))
```

```{r, eval=TRUE, echo=FALSE}
prior_range <- seq(500,800,by=0.05)
prior_like <- dinvgamma(prior_range, shape = 1, rate = 1)

plot(prior_range, prior_like, type = 'l',
     main = "Prior/Post Dist. of NL Variance",
     xlab = expression(sigma^2),
     ylab = "Likelihood", ylim = c(0,0.025))
lines(density(vars_NL), lty = 2)
legend("topright", c('Prior','Posterior'), lty = c(1,2))
```


Then perform the posterior inference on the difference in means. 
```{r, eval=TRUE, echo=FALSE}
diffs <- mus_NL-mus_AL
mean(diffs)
sd(diffs)
```


Report and properly interpret an associated credible interval for this function of parameters. 
```{r, eval=TRUE, echo=FALSE}
quantile(probs=c(0.025, 0.975), diffs)
```

```{r, eval=TRUE, echo=FALSE}
plot(density(diffs), main = expression(paste("Density of ", mu[NL]-mu[AL])),
     xlab = expression(mu[NL]-mu[AL]))
```

*Concerned about the above plot.*
*trace plots of diffs, mus_AL, and mus_NL*
*Discarding first 20,000 obs yields extrememly low correlation and smooth/accurate estimate.*

## Discussion

Summarize your results 

identify shortcomings of the work, and 

explain what could be done in the future to either better answer your question or to address a natural follow-up question 

## Appendix (R code)
