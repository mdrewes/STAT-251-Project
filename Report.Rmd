---
title: "A Comparison of Homerun Distance Between American League and National League Hitters"
author: "Caleb Pulsipher and Matt Drewes"
output: 
  pdf_document: 
    latex_engine: xelatex
---

```{r}
for (x in c("AL.RData","NL.RData","All.RData")){load(x)}
AL <- AL$True.Distance
NL <- NL$True.Distance
```


```{r, Results}
update.mu <- function(sigma2, ys, m, v){
  
  n <- length(ys)
  vstar <- 1/(n/sigma2+1/v)
  mstar <- vstar*(n*mean(ys)/sigma2+m/v)
  return( rnorm(1, mstar, sqrt(vstar)) )
  
}

update.var <- function(mu, ys, a, b){
  
  n <- length(ys)
  astar <- a + n/2
  bstar <- b + 0.5*sum( (ys-mu)^2 )
  return( 1/rgamma(1, astar, bstar) )
  
}
```

```{r, AL Gibbs}
obs_AL <- AL
m_AL <- 420
v_AL <- 225
a_AL <- 1
b_AL <- 1

set.seed(2017) 

N <- 100000
mus_AL <- rep(NA, N)
vars_AL <- rep(NA, N)

mus_AL[1] <- mean(obs_AL) 
vars_AL[1] <- var(obs_AL)

for (j in 2:N){
  mus_AL[j] <- update.mu(sigma2 = vars_AL[j-1], ys = obs_AL, m=m_AL, v=v_AL)
  vars_AL[j] <- update.var(mu = mus_AL[j], ys = obs_AL, a = a_AL, b = b_AL)
}
```

```{r, Plots AL}
par(mfrow = c(2,2))
plot(mus_AL[1:1000], type="l",
   main=expression(paste("Trace plot for ", mu)))

plot(vars_AL[1:1000], type="l",
  main=expression(paste(
   "Trace plot for ", sigma^2)))

acf(mus_AL, main = "") 

acf(vars_AL, main = "")
```

```{r, NL Gibbs}
obs_NL <- NL
m_NL <- 420
v_NL <- 225
a_NL <- 1 # We can look at changing these values
b_NL <- 1 # ^

set.seed(2017) 

N <- 100000
mus_NL <- rep(NA, N)
vars_NL <- rep(NA, N)

mus_NL[1] <- mean(obs_NL) 
vars_NL[1] <- var(obs_NL)

for (j in 2:N){
  mus_NL[j] <- update.mu(sigma2 = vars_NL[j-1], ys = obs_NL, m=m_NL, v=v_NL)
  vars_NL[j] <- update.var(mu = mus_NL[j], ys = obs_NL, a = a_NL, b = b_NL)
}
```

```{r, Plots NL}
par(mfrow = c(2,2))
plot(mus_NL[1:1000], type="l",
   main=expression(paste("Trace plot for ", mu)))

plot(vars_NL[1:1000], type="l",
  main=expression(paste(
   "Trace plot for ", sigma^2)))

acf(mus_NL, main = "") 

acf(vars_NL, main = "")
```


## Introduction

Is there any difference in average home run distance between the MLB's two leagues? The purpose of investigating this question is to see if one league, American League (AL) or National League (NL), has a statistical advantage when it comes to home run distance. This is important because each field has varying home run distances (the minimum distance required to clear the home run limit), which would give a competitive edge to the league that can hit farther home runs on average.

## Methods

The data were obtained from ESPNâ€™s "hittracker" site (http://www.hittrackeronline.com/top_true_distance.php). This site is run by ESPN Stats and Information Group. The original data consists of a list of each home run hit in the 2017 season, which player hit the home run, the player's team, and the true distance of the hit (defined as the estimated total distance the ball would have traveled in the absence of physical barriers) in feet.

We assume a normal distribution for the homerun distances of each population. This assumption is justified both by a histogram of each sample and by a normal probability plot of each sample.

```{r, eval=TRUE, echo=FALSE}
par(mfrow=c(1,2))
hist(AL)
hist(NL)
```

```{r, eval=TRUE, echo=FALSE}
par(mfrow=c(1,2))
qqnorm(AL, main = "Normal Q-Q Plot of AL Data")
qqline(AL)
qqnorm(NL, main = "Normal Q-Q Plot of NL Data")
qqline(NL)
```

The relevant parameters for the likelihood are the population mean and variance. It is reasonable to assume the data are conditionally iid, based on the indviduality of the batters. For the prior distribution of $\mu_{AL}$ and $\mu_{NL}$, the mean home run distance for each respective league, we chose a Normal distribution with a mean of 420 ft. and a variance of 15^2 ft, based on our best guess for the means and our understanding of the overall spread of homerun distances. For an objective prior distribution for both $\sigma^2_{AL}$ and $\sigma^2_{NL}$, we chose an inverse gamma with shape=1 and rate=1.

```{r, eval=TRUE, echo=FALSE}
prior_range <- seq(300,500,by=0.05)
prior_like <- dnorm(prior_range, mean = 420, sd = 15)
plot(prior_range, prior_like, type = 'l',
     main = "Prior Distribution of the Mean",
     xlab = expression(mu),
     ylab = "Likelihood")
```

```{r}
library(invgamma)
prior_range <- seq(0,10,by=0.05)
# prior_like <- 1/dgamma(prior_range, shape = 1, rate = 1)
prior_like <- dinvgamma(prior_range, shape = 1, rate = 1)
plot(prior_range, prior_like, type = 'l',
     main = "Prior Distribution of the Variance",
     xlab = expression(sigma^2),
     ylab = "Likelihood")
```

The populations of interest in our study are the home run distances of the "current" American League and National League. In the context of professional sports, where teams inevitably change between seasons, "current" is loosely defined and could be considered as the state of the league from a few seasons past to a few seasons in the future. Thus, our data, the actual results of the 2017 season, can be considered samples these two populations.

For the analysis itself, we employ Gibbs sampling to simulate potential values of the parameters, followed by Monte Carlo estimation. We use the results, in the form of posterior distributions, to provide evidence for our research question both graphically and computationally. First, because we assumed an identical prior distribution of the AL and NL mean home run distances, any difference in the visual representation of the posterior distributions is potentially indicative of a significant difference between the two leagues. For verification, we compute the differences between our simulated means, after which we provide a statistically plausible interval for the true difference and determine whether or not we have sufficient evidence to conclude that there is a significant difference in the populations.


## Results

*Mean of American League Mean Homerun Distance:*
```{r, eval=TRUE, echo=FALSE}
mean(mus_AL)
```

*Standard Deviation of American League Mean Homerun Distance:*
```{r, eval=TRUE, echo=FALSE}
sd(mus_AL)
```


*Mean of National League Mean Homerun Distance:*
```{r, eval=TRUE, echo=FALSE}
mean(mus_NL)
```

*Standard Deviation of National League Mean Homerun Distance:*
```{r, eval=TRUE, echo=FALSE}
sd(mus_NL)
```


*Mean of American League Mean Homerun Distance:*
```{r, eval=TRUE, echo=FALSE}
mean(vars_AL)
```

*Standard Deviation of American League Mean Homerun Distance:*
```{r, eval=TRUE, echo=FALSE}
sd(vars_AL)
```

*Mean of American League Mean Homerun Distance:*
```{r, eval=TRUE, echo=FALSE}
mean(vars_NL)
```

*Standard Deviation of American League Mean Homerun Distance:*
```{r, eval=TRUE, echo=FALSE}
sd(vars_NL)
```
Include and interpret credible intervals.  
```{r, eval=TRUE, echo=FALSE}
plot(density(mus_AL), main = "Estimated Density of Means", xlab = expression(mu))
lines(density(mus_NL), lty = 2)
legend("topright", c('AL','NL'), lty = c(1,2))
```

```{r, eval=TRUE, echo=FALSE}
plot(density(vars_AL), main = "Estimated Density of Variances", xlab = expression(sigma^2),
     xlim = c(500,800), ylim = c(0,0.025))
lines(density(vars_NL), lty = 2)
legend("topright", c('AL','NL'), lty = c(1,2))
```

```{r, eval=TRUE, echo=FALSE}
prior_range <- seq(350,450,by=0.05)
prior_like <- dnorm(prior_range, mean = 420, sd = 15)

plot(prior_range, prior_like, type = 'l',
     main = "Prior/Post Dist. of AL Mean",
     xlab = expression(mu),
     ylab = "Likelihood", ylim = c(0,0.8))
lines(density(mus_AL), lty = 2)
legend("topright", c('Prior','Posterior'), lty = c(1,2))
```

```{r, eval=TRUE, echo=FALSE}
prior_range <- seq(300,500,by=0.05)
prior_like <- dnorm(prior_range, mean = 420, sd = 15)

plot(prior_range, prior_like, type = 'l',
     main = "Prior/Post Dist. of NL Mean",
     xlab = expression(mu),
     ylab = "Likelihood", ylim = c(0,0.8))
lines(density(mus_NL), lty = 2)
legend("topright", c('Prior','Posterior'), lty = c(1,2))
```

```{r, eval=TRUE, echo=FALSE}
prior_range <- seq(500,800,by=0.05)
prior_like <- dinvgamma(prior_range, shape = 1, rate = 1)

plot(prior_range, prior_like, type = 'l',
     main = "Prior/Post Dist. of AL Variance",
     xlab = expression(sigma^2),
     ylab = "Likelihood", ylim = c(0,0.025))
lines(density(vars_AL), lty = 2)
legend("topright", c('Prior','Posterior'), lty = c(1,2))
```

```{r, eval=TRUE, echo=FALSE}
prior_range <- seq(500,800,by=0.05)
prior_like <- dinvgamma(prior_range, shape = 1, rate = 1)

plot(prior_range, prior_like, type = 'l',
     main = "Prior/Post Dist. of NL Variance",
     xlab = expression(sigma^2),
     ylab = "Likelihood", ylim = c(0,0.025))
lines(density(vars_NL), lty = 2)
legend("topright", c('Prior','Posterior'), lty = c(1,2))
```

```{r, eval=TRUE, echo=FALSE}
diffs <- mus_NL-mus_AL
mean(diffs)
sd(diffs)
```

```{r, eval=TRUE, echo=FALSE}
quantile(probs=c(0.025, 0.975), diffs)
```

```{r, eval=TRUE, echo=FALSE}
plot(density(diffs), main = expression(paste("Density of ", mu[NL]-mu[AL])),
     xlab = expression(mu[NL]-mu[AL]))
```

*Concerned about the above plot.*
*trace plots of diffs, mus_AL, and mus_NL*
*Discarding first 20,000 obs yields extrememly low correlation and smooth/accurate estimate.*

## Discussion

Summarize your results 

identify shortcomings of the work, and 

explain what could be done in the future to either better answer your question or to address a natural follow-up question 

## Appendix (R code)
